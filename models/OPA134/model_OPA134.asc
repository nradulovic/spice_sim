Version 4
SHEET 1 2128 1716
WIRE -384 -240 -384 -288
WIRE -384 -128 -384 -160
WIRE 176 0 32 0
WIRE 576 0 240 0
WIRE 32 96 32 0
WIRE 32 96 -64 96
WIRE 128 96 32 96
WIRE 224 96 128 96
WIRE 400 96 288 96
WIRE 512 96 400 96
WIRE 576 96 576 0
WIRE 704 96 576 96
WIRE 864 96 768 96
WIRE 960 96 864 96
WIRE 1056 96 960 96
WIRE 1216 96 1120 96
WIRE 1312 96 1216 96
WIRE 1440 96 1312 96
WIRE 1600 96 1504 96
WIRE -384 128 -544 128
WIRE -320 128 -384 128
WIRE -192 128 -240 128
WIRE -128 128 -192 128
WIRE -64 128 -64 96
WIRE 128 128 128 96
WIRE 288 128 288 96
WIRE 576 128 576 96
WIRE 768 128 768 96
WIRE 864 128 864 96
WIRE 960 128 960 96
WIRE 1120 128 1120 96
WIRE 1216 128 1216 96
WIRE 1312 128 1312 96
WIRE 1504 128 1504 96
WIRE -128 144 -128 128
WIRE -112 144 -128 144
WIRE 224 144 224 96
WIRE 240 144 224 144
WIRE 512 144 512 96
WIRE 528 144 512 144
WIRE 704 144 704 96
WIRE 720 144 704 144
WIRE 1056 144 1056 96
WIRE 1072 144 1056 144
WIRE 1440 144 1440 96
WIRE 1456 144 1440 144
WIRE -480 192 -544 192
WIRE -112 192 -480 192
WIRE 240 192 224 192
WIRE 528 192 512 192
WIRE 720 192 704 192
WIRE 1072 192 1056 192
WIRE 1456 192 1440 192
WIRE -64 224 -64 208
WIRE 128 224 128 208
WIRE 128 224 -64 224
WIRE 224 224 224 192
WIRE 224 224 128 224
WIRE 288 224 288 208
WIRE 512 224 512 192
WIRE 512 224 288 224
WIRE 704 224 704 192
WIRE 768 224 768 208
WIRE 768 224 704 224
WIRE 864 224 864 208
WIRE 864 224 768 224
WIRE 960 224 960 192
WIRE 960 224 864 224
WIRE 1056 224 1056 192
WIRE 1120 224 1120 208
WIRE 1120 224 1056 224
WIRE 1216 224 1216 208
WIRE 1216 224 1120 224
WIRE 1312 224 1312 192
WIRE 1312 224 1216 224
WIRE 1440 224 1440 192
WIRE 1504 224 1504 208
WIRE 1504 224 1440 224
WIRE 128 256 128 224
WIRE 288 256 288 224
WIRE 576 256 576 208
WIRE 768 256 768 224
WIRE 1120 256 1120 224
WIRE 1504 256 1504 224
WIRE -480 320 -480 192
WIRE -480 320 -576 320
WIRE -384 320 -384 128
WIRE -288 320 -384 320
WIRE -576 336 -576 320
WIRE -288 336 -288 320
WIRE -576 416 -576 400
WIRE -480 416 -480 400
WIRE -480 416 -576 416
WIRE -432 416 -480 416
WIRE -384 416 -384 400
WIRE -384 416 -432 416
WIRE -288 416 -288 400
WIRE -288 416 -384 416
WIRE 1600 416 1600 96
WIRE 1600 416 -64 416
WIRE -432 512 -432 416
WIRE -64 512 -64 416
WIRE 0 512 -64 512
WIRE 160 512 80 512
WIRE 336 512 240 512
WIRE 352 512 336 512
WIRE 448 512 432 512
WIRE 512 512 448 512
WIRE 1600 512 592 512
WIRE -256 592 -448 592
WIRE -256 608 -256 592
WIRE -128 624 -208 624
WIRE -448 672 -448 592
WIRE -448 672 -544 672
WIRE -160 672 -208 672
WIRE -448 704 -448 672
WIRE -256 752 -256 688
WIRE -256 752 -304 752
WIRE -256 784 -256 752
WIRE 592 784 592 752
WIRE 784 784 784 752
WIRE 976 784 976 752
WIRE -448 800 -448 784
WIRE -448 800 -544 800
WIRE -128 800 -208 800
WIRE 448 800 448 512
WIRE 544 800 448 800
WIRE -160 848 -160 672
WIRE -160 848 -208 848
WIRE 336 848 336 512
WIRE 544 848 336 848
WIRE -448 880 -448 800
WIRE -256 880 -256 864
WIRE -256 880 -448 880
WIRE -160 912 -160 848
WIRE 592 912 592 864
WIRE 784 912 784 864
WIRE 976 912 976 864
WIRE -448 1136 -448 1088
WIRE -256 1136 -256 1088
WIRE -448 1280 -448 1216
WIRE -256 1280 -256 1216
WIRE -160 1408 -448 1408
WIRE -448 1440 -448 1408
WIRE 192 1456 64 1456
WIRE -160 1504 -192 1504
WIRE -448 1552 -448 1520
WIRE -192 1600 -192 1504
WIRE -64 1600 -192 1600
WIRE 192 1600 192 1456
WIRE 192 1600 16 1600
WIRE -192 1696 -192 1680
WIRE 192 1696 192 1680
FLAG 128 256 0
FLAG 288 256 0
FLAG -544 128 IN+
IOPIN -544 128 In
FLAG -544 192 IN-
IOPIN -544 192 In
FLAG -192 128 INo+
FLAG -432 512 1_VR
FLAG -384 -128 0
FLAG -384 -288 1_VR
FLAG -544 672 V+
IOPIN -544 672 In
FLAG -544 800 V-
IOPIN -544 800 In
FLAG 576 256 0
FLAG 400 96 N3
FLAG 768 256 0
FLAG 1120 256 0
FLAG 1504 256 0
FLAG 592 912 0
FLAG 592 752 VH0
FLAG 784 912 0
FLAG 784 752 1_IOP
FLAG 976 912 0
FLAG 976 752 1_ION
FLAG -160 912 0
FLAG -304 752 1_VR
FLAG -128 624 1_IOP
FLAG -128 800 1_ION
FLAG 1600 512 out
IOPIN 1600 512 Out
FLAG -448 1280 0
FLAG -256 1280 0
FLAG -448 1088 v+
FLAG -256 1088 v-
FLAG -448 1552 0
FLAG -160 1408 in+
FLAG -160 1504 in-
FLAG -192 1696 0
FLAG 192 1696 0
FLAG 64 1456 out
SYMBOL res 112 112 R0
SYMATTR InstName R1
SYMATTR Value 1
SYMBOL voltage -224 128 R90
WINDOW 0 -32 56 VBottom 0
WINDOW 3 32 56 VTop 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value {VOS}
SYMBOL res -496 304 R0
SYMATTR InstName R2
SYMATTR Value {RIN}
SYMBOL res -400 304 R0
SYMATTR InstName R3
SYMATTR Value {RIN}
SYMBOL cap -304 336 R0
SYMATTR InstName C1
SYMATTR Value {CIN}
SYMBOL cap -592 336 R0
SYMATTR InstName C2
SYMATTR Value {CIN}
SYMBOL bv -384 -256 R0
SYMATTR InstName B2
SYMATTR Value V=(V(V+)+V(V-))/2
SYMBOL current -448 704 R0
WINDOW 3 24 144 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 24 116 Left 0
SYMATTR Value {IQ}
SYMATTR SpiceLine load
SYMATTR InstName I1
SYMBOL cap 240 -16 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName C3
SYMATTR Value {1m/SR}
SYMBOL g2 768 224 M180
SYMATTR InstName G2
SYMATTR Value -1m
SYMBOL res 848 112 R0
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL cap 944 128 R0
WINDOW 3 -211 163 Left 0
SYMATTR Value {1/(6.28K*FU*(128/(90-PM)-0.422))}
SYMATTR InstName C4
SYMBOL g2 1120 224 M180
SYMATTR InstName G3
SYMATTR Value -1m
SYMBOL res 1200 112 R0
SYMATTR InstName R5
SYMATTR Value 1k
SYMBOL cap 1296 128 R0
WINDOW 3 -109 161 Left 0
SYMATTR Value {1/(6.28K*FU*(128/(90-PM)-0.422))}
SYMATTR InstName C5
SYMBOL e 1504 112 R0
SYMATTR InstName E2
SYMATTR Value 1
SYMBOL bv -16 512 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 -32 56 VBottom 0
SYMATTR InstName B3
SYMATTR Value V=IF(V(1_IOP)>{ILP},10K*(V(1_IOP)-{ILP}),0)
SYMBOL bv 256 512 R90
WINDOW 0 -32 56 VBottom 0
WINDOW 3 -90 58 VTop 0
SYMATTR InstName B4
SYMATTR Value V=IF(V(1_ION)>{ILN},10K*(V(1_ION)-{ILN}),0)
SYMBOL res 448 496 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R6
SYMATTR Value 1m
SYMBOL bv 784 768 R0
WINDOW 3 -174 198 Left 0
SYMATTR Value V=IF(V(VH0)>0,V(VH0),0)
SYMATTR InstName B6
SYMBOL bv 976 768 R0
SYMATTR InstName B7
SYMATTR Value V=IF(V(VH0)<0,-1*V(VH0),0)
SYMBOL res 608 496 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R7
SYMATTR Value {R0}
SYMBOL g2 -256 704 R180
SYMATTR InstName G4
SYMATTR Value 1
SYMBOL g2 -256 880 R180
SYMATTR InstName G5
SYMATTR Value 1
SYMBOL voltage -448 1120 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 132 Left 0
SYMATTR SpiceLine Rser=1
SYMATTR InstName V2
SYMATTR Value 15
SYMBOL voltage -256 1232 R180
WINDOW 0 24 104 Left 0
WINDOW 3 24 16 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 24 -12 Left 0
SYMATTR InstName V3
SYMATTR Value 15
SYMATTR SpiceLine Rser=1
SYMBOL voltage -448 1424 R0
WINDOW 123 24 132 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value2 AC 1
SYMATTR InstName V4
SYMATTR Value SINE(0 10 1k)
SYMBOL res -208 1584 R0
SYMATTR InstName R8
SYMATTR Value 1k
SYMBOL res 32 1584 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R9
SYMATTR Value 9k
SYMBOL res 176 1584 R0
SYMATTR InstName R10
SYMATTR Value 2k
SYMBOL bi -64 128 R0
WINDOW 3 -103 213 Left 0
SYMATTR Value I=LIMIT((6.28m*{FU}/{SR})*(V(INo+,IN-)+(V(INo+)+V(IN-))/(2*{CMR})),-1*1m,1m)
SYMATTR InstName B8
SYMBOL bv 576 112 R0
WINDOW 3 33 -62 Left 0
SYMATTR Value V=((V(V+,V-)-{VRP}-{VRN})/3.14)*ATAN({SR}/{FU}*{AV}/2*V(N3,0)/(V(V+,V-)-{VRP}-{VRN}))+ (V(V+)+V(V-)-{VRP}+{VRN})/2
SYMATTR InstName B9
SYMBOL e 288 112 R0
SYMATTR InstName E1
SYMATTR Value -1e3
SYMBOL e 592 768 R0
SYMATTR InstName E3
SYMATTR Value -1e3
TEXT -184 -88 Left 0 !;op
TEXT 832 -272 Left 0 !.param FU 10meg
TEXT 832 -240 Left 0 !.param SR 20meg
TEXT 832 -208 Left 0 !.param CMR 1.78meg
TEXT 832 -176 Left 0 !.param VOS 2m
TEXT 832 -144 Left 0 !.param VRP 2
TEXT 832 -112 Left 0 !.param VRN 2
TEXT 832 -80 Left 0 !.param RIN 1meg
TEXT 832 -48 Left 0 !.param CIN 2.2p
TEXT 832 -304 Left 0 !.param AV 1.78meg
TEXT 832 -16 Left 0 !.param PM 45
TEXT 1184 -304 Left 0 !.param ILP 35m
TEXT 1184 -272 Left 0 !.param ILN 30m
TEXT 1184 -240 Left 0 !.param R0 10
TEXT -952 984 Left 0 !;ac oct 10 10 100meg
TEXT 1184 -208 Left 0 !.param IQ 5m
TEXT -912 1032 Left 0 !.option noopiter
TEXT -920 1336 Left 0 !.tran 0 10m 0 1u
